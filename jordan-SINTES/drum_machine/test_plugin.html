<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="description" content="Create custom drum beats with a few clicks.  Choose from 15 drum kits and 26 effects, and adjust the pitch of each drum.  Save and share your beatsâ€¦ rock on!">
    <title>Test Plugin</title>

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Michroma">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Droid Sans">

    <script src="https://cwilso.github.io/AudioContext-MonkeyPatch/AudioContextMonkeyPatch.js"></script>

    <!-- Set up Web MIDI polyfill -->
    
</head>

<script src="./../../sdk/WebAudioSDK.js"></script>
<script src="./drumMachine/main.js"></script>

<body>
    <audio src="./../../BasketCaseGreendayriffDI.mp3" id="soundSample" controls loop></audio>
</body>

<script>

	var ctx = new AudioContext();
    var player = document.getElementById("soundSample");
   
    player.onplay = () => 
    {
        ctx.resume().then(() => 
        {
			console.log('Playback resumed successfully');
		});
	}
	var mediaSource = ctx.createMediaElementSource(player);

    var pluginURL = "./drumMachine"; 
	var plugin = new DrumMachine(ctx, pluginURL);

   plugin.load().then((node) => 
    {
        console.log("node", node);
        plugin.loadGui().then((elem) => 
        {
            console.log("elem", elem);
            document.body.appendChild(elem);
        });
        
		mediaSource.connect(node);
		node.connect(ctx.destination);
	});
    
    Kit.prototype.setDemoIndex = function (index) {
	this.demoIndex = index;
}

Kit.prototype.load = function () {
	if (this.startedLoading)
		return;

	this.startedLoading = true;

	var pathName = this.pathName();

	var kickPath = pathName + "kick.wav";
	var snarePath = pathName + "snare.wav";
	var hihatPath = pathName + "hihat.wav";
	var tom1Path = pathName + "tom1.wav";
	var tom2Path = pathName + "tom2.wav";
	var tom3Path = pathName + "tom3.wav";

	//put to true to have sound position in function to the click position on drumMachine
	this.loadSample(0, kickPath, false);
	this.loadSample(1, snarePath, false);
	this.loadSample(2, hihatPath, false);
	this.loadSample(3, tom1Path, false);
	this.loadSample(4, tom2Path, false);
	this.loadSample(5, tom3Path, false);
}

Kit.prototype.loadSample = function (sampleID, url) {
	// Load asynchronously

	var request = new XMLHttpRequest();
	request.open("GET", url, true);
	request.responseType = "arraybuffer";

	var kit = this;

	request.onload = function () {
		context.decodeAudioData(request.response, decodedFunctions[sampleID].bind(kit));

		kit.instrumentLoadCount++;
		if (kit.instrumentLoadCount == kit.instrumentCount) {
			kit.isLoaded = true;

			if (kit.demoIndex != -1) {
				beatInitial.setKitLoaded();
			}
		}
	}

	request.send();
}

	
   

</script>

</html>