<script src="./faust-zitaRev-aw-files/FaustZitaRev.js"></script>
<script src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/bower_components/webaudio-controls2/webcomponents-lite.js"></script>
<script>
  WebAudioControlsOptions = {
    useMidi: 1,
  };
</script>
<script src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/bower_components/webaudio-controls2/webaudio-controls.js"></script>
<!-- <link rel="import" href="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/bower_components/polymer/polymer.html">
<link rel="import" href="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/bower_components/webaudio-controls/webaudio-controls.html"> -->
<template id="wc-zitarev">
  <style>
    :host {
      /* box-shadow: inset -3px -3px 3px 5px rgba(0, 0, 0, 0.6), inset 3px 3px 3px 5px rgba(255, 255, 255, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.9), 0 4px 5px 0 rgba(0, 0, 0, 0.9), 0 1px 10px 0 rgba(0, 0, 0, 0.9); */
      /* box-shadow: inset -3px -3px 3px 5px rgba(0, 0, 0, 0.69), inset 3px 3px 3px 2px rgba(255, 255, 255, 0.45), 0 2px 4px -1px rgba(0, 0, 0, 0), 0 4px 5px 0 rgba(0, 0, 0, 0), 0 1px 10px 0 rgba(181, 181, 181, 0); */
      box-shadow: 4px 5px 6px rgba(0, 0, 0, 0.7), inset -2px -2px 5px 0px rgba(0, 0, 0, 0.2), inset 3px 1px 1px 4px rgba(255, 255, 255, 0.2), 1px 0px 1px 0px rgba(0, 0, 0, 0.9), 0 2px 1px 0 rgba(0, 0, 0, 0.9), 1px 1px 1px 0px rgba(0, 0, 0, 0.9);


      width: [[dataWidth]]px;
      /* height: [[dataHeight]]px; */
      position: absolute;
      top: 0px;
      left: 0px;
      display: block;
      user-select: none;
      cursor: move;
      z-index: 9;
    }

    :host {
      border-bottom-left-radius: 8px;
      border-bottom-right-radius: 8px;
    }

    .pedalLabel,
    .div_buttons {
      border-radius: 8px;
    }

    .div_menuPanel {
      /* border-top-left-radius: 8px;
        border-top-right-radius: 8px; */
    }

    .laPedale {
      /* box-shadow: inset 0px 3px 10px #111; */
    }

    webaudio-switch {
      left: -6px;
    }

    .pedalLabel {
      /* background: rgba(0, 0, 0, 0.4); */
      box-shadow: inset 0px 1px 5px #111;
      border: 1px solid #ccc;
      color: #ccc;
      /* border:2px solid #aaa; */
      padding: 4px 10px;
      margin: 2px 0px;

      font-size: 10px;
      text-align: center;
      user-select: none;
      /* font-family: Lemon\/Milk; */
      font-family: helvetica;
      text-transform: uppercase;
    }

    .knob-label {
      color: #ddd;
      text-shadow: 0px 1px 1px #000;

      font-size: 6px;
      margin-top: -2px;

      text-align: center;
      text-transform: uppercase;
      overflow: hidden;
      user-select: none;
      font-family: helvetica;

    }

    .elements {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;

      padding: 10px;
    }

    .column {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;

      flex: 1;
      margin: 3px;
    }

    .row {
      display: flex;
      flex-direction: row;
      justify-content: flex-start;
      align-items: stretch;
    }
  </style>
  <div class="row">
    <div class="column">
      <webaudio-knob id="knob1" class="knob" sprites="99" value="60" min="20" max="100" step="1" midilearn="true" width="40" height="40"
        src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png" data-role="in_Delay"></webaudio-knob>
      <span class="knob-label" id="knob1-label">in_Delay</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob2" class="knob" sprites="99" value="200" min="50" max="1000" step="1" midilearn="true" width="40"
        height="40" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png"
        data-role="LF_X"></webaudio-knob>
      <span class="knob-label" id="knob2-label">LF_X</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob3" class="knob" sprites="99" value="3" min="1" max="8" step="0.1" midilearn="true" width="40" height="40"
        src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png" data-role="Low_RT60"></webaudio-knob>
      <span class="knob-label" id="knob3-label">Low_RT60</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob4" class="knob" sprites="99" value="2" min="1" max="8" step="0.1" midilearn="true" width="40" height="40"
        src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png" data-role="Mid_RT60"></webaudio-knob>
      <span class="knob-label" id="knob4-label">Mid_RT60</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob5" class="knob" sprites="99" value="6000" min="1500" max="23520" step="1" midilearn="true" width="40"
        height="40" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png"
        data-role="HF_Damping"></webaudio-knob>
      <span class="knob-label" id="knob5-label">HF_Damping</span>
    </div>
  </div>
  <div class="row">
    <div class="column">
      <webaudio-knob id="knob6" class="knob" sprites="99" value="315" min="40" max="2500" step="1" midilearn="true" width="40"
        height="40" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png"
        data-role="Eq1_Freq"></webaudio-knob>
      <span class="knob-label" id="knob6-label">Eq1_Freq</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob7" class="knob" sprites="99" value="0" min="-15" max="15" step="0.1" midilearn="true" width="40" height="40"
        src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png" data-role="Eq1_Level"></webaudio-knob>
      <span class="knob-label" id="knob7-label">Eq1_Level</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob8" class="knob" sprites="99" value="1500" min="160" max="10000" step="1" midilearn="true" width="40"
        height="40" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png"
        data-role="Eq2_Freq"></webaudio-knob>
      <span class="knob-label" id="knob8-label">Eq2_Freq</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob9" class="knob" sprites="99" value="0" min="-15" max="15" step="0.1" midilearn="true" width="40" height="40"
        src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png" data-role="Eq2_Level"></webaudio-knob>
      <span class="knob-label" id="knob9-label">Eq2_Level</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob10" class="knob" sprites="99" value="0" min="-1" max="1" step="0.01" midilearn="true" width="40" height="40"
        src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png" data-role="Wet_Mix"></webaudio-knob>
      <span class="knob-label" id="knob10-label">Wet_Mix</span>
    </div>
    <div class="column">
      <webaudio-knob id="knob11" class="knob" sprites="99" value="10" min="-70" max="40" step="0.1" midilearn="true" width="40"
        height="40" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_black_white_stripe.png"
        data-role="Level"></webaudio-knob>
      <span class="knob-label" id="knob11-label">Level</span>
    </div>
  </div>
  <div class="row">
    <div class="column">
      <webaudio-switch midilearn="true" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/switch_1.png"
        class="switch" id="switch1" width="40" height="25"></webaudio-switch>
    </div>
  </div>
  <div class="row">
    <div class="column">
      <span class="pedalLabel">FAUST ZitaRev</span>
    </div>
  </div>
</template>
<script>
  let wctemp = document.currentScript.ownerDocument.querySelector("#wc-zitarev");
  class ZitaRevGui extends HTMLElement {
    static get is() { return 'wc-zitarev'; }

    constructor() {
      super();
      this._root = this.attachShadow({ mode: 'open' });
      this._root.appendChild(wctemp.content.cloneNode(true));
      this.isOn = true;
    }

    static get properties() {
      this.boundingRect = {
        dataWidth: {
          type: Number,
          value: 300
        },
        dataHeight: {
          type: Number,
          value: 200
        }
      };
      return this.boundingRect;
    }
    set plug(p) {
      console.log(this);
      this._plug = p;
      this.setKnobs();
      this.setSwitchListener();

    }

    setKnobs() {
      this._root.querySelector("#knob1").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/Input/In_Delay", e.target.value),false);
      this._root.querySelector("#knob2").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/Decay_Times_in_Bands_(see_tooltips)/LF_X", e.target.value));
      this._root.querySelector("#knob3").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/Decay_Times_in_Bands_(see_tooltips)/Low_RT60", e.target.value));
      this._root.querySelector("#knob4").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/Decay_Times_in_Bands_(see_tooltips)/Mid_RT60", e.target.value));
      this._root.querySelector("#knob5").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/Decay_Times_in_Bands_(see_tooltips)/HF_Damping", e.target.value));
      this._root.querySelector("#knob6").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/RM_Peaking_Equalizer_1/Eq1_Freq", e.target.value));
      this._root.querySelector("#knob7").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/RM_Peaking_Equalizer_1/Eq1_Level", e.target.value));
      this._root.querySelector("#knob8").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/RM_Peaking_Equalizer_2/Eq2_Freq", e.target.value));
      this._root.querySelector("#knob9").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/RM_Peaking_Equalizer_2/Eq2_Level", e.target.value));
      this._root.querySelector("#knob10").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/Output/Dry/Wet_Mix", e.target.value));
      this._root.querySelector("#knob11").addEventListener('change', (e) => this._plug.setParam("/Zita_Rev1/Output/Level", e.target.value),false);
    }



    // buildGraph(ctx){
    //   this.fst = faust.createzitaRev(ctx, ((dsp) => {
    //     console.log("GOT ZITA REV WA!!!");
    //     this.effect = dsp;
    //     let jsonDesc = this.effect.getJSON();
    //     var params = this.effect.getParams();
    //     console.log(params);
    //     console.log(jsonDesc);
    //     this.$.knob1.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/Input/In_Delay", e.target.value));
    //     this.$.knob2.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/Decay_Times_in_Bands_(see_tooltips)/LF_X", e.target.value));
    //     this.$.knob3.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/Decay_Times_in_Bands_(see_tooltips)/Low_RT60", e.target.value));
    //     this.$.knob4.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/Decay_Times_in_Bands_(see_tooltips)/Mid_RT60", e.target.value));
    //     this.$.knob5.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/Decay_Times_in_Bands_(see_tooltips)/HF_Damping", e.target.value));
    //     this.$.knob6.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/RM_Peaking_Equalizer_1/Eq1_Freq", e.target.value));
    //     this.$.knob7.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/RM_Peaking_Equalizer_1/Eq1_Level", e.target.value));
    //     this.$.knob8.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/RM_Peaking_Equalizer_2/Eq2_Freq", e.target.value));
    //     this.$.knob9.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/RM_Peaking_Equalizer_2/Eq2_Level", e.target.value));
    //     this.$.knob10.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/Output/Dry/Wet_Mix", e.target.value));
    //     this.$.knob11.addEventListener('change', (e) => this.effect.setParamValue("/Zita_Rev1/Output/Level", e.target.value));
    //   }));

    // }
    // getEffect(){
    //   return this.effect;
    //   console.log(this.effect);
    // }

    setSwitchListener() {
      console.log("setswitch");
      this._root.querySelector("#switch1").addEventListener('change', (e) => {
        if (this.isOn) this.bypass()
        else this.reactivate();
        this.isOn = !this.isOn;
      });
    }

    bypass() {
      this._plug.setParam("/Zita_Rev1/Output/Dry/Wet_Mix", -1);
      console.log("disabled");
    }

    reactivate() {
      this._plug.setParam("/Zita_Rev1/Output/Dry/Wet_Mix", 1);

    }


  }
  // Register the x-custom element with the browser
  customElements.define('wc-zitarev', ZitaRevGui);
</script>