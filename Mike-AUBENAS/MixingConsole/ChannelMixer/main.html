<script src="https://wasabi.i3s.unice.fr/WebAudioPluginBank/bower_components/webaudio-controls2/webcomponents-lite.js"></script>
<script> WebAudioControlsOptions = { useMidi: 1 }; </script>
<script src="https://wasabi.i3s.unice.fr/WebAudioPluginBank/bower_components/webaudio-controls2/webaudio-controls.js"></script>

<template id="wc-channelmixer">
    <style>
        :host 
		{
			background: linear-gradient( rgb(77, 74, 78),rgb(136, 5, 129));
			box-shadow: 4px 5px 6px rgba(0, 0, 0, 0.7), 
						inset -2px -2px 5px 0px rgba(0, 0, 0, 0.2), 
						inset 3px 1px 1px 4px rgba(255, 255, 255, 0.2), 
						1px 0px 1px 0px rgba(0, 0, 0, 0.9), 
						0 2px 1px 0 rgba(0, 0, 0, 0.9), 
						1px 1px 1px 0px rgba(0, 0, 0, 0.9);

			width: 135px;
			height: 180px;
			display: block;
			user-select: none;
			cursor: move;
			z-index: 9;

			border-bottom-left-radius: 8px;
			border-bottom-right-radius: 8px;
		}
    </style>

    <div id="main"> 
        <p id="channelNumber"><b></b></p>  
        <p>Gain <input id="gain" type="range" min="0" max="10" value="2" step="0.1"></p> 
        <webaudio-slider id="slider1" midilearn="true" units="Db" 
            style="position:absolute;left:731px;top:64px" src="./MixingConsole/ChannelMixer/Image/vsliderbody.png" 
            knobsrc="./MixingConsole/ChannelMixer/Image//vsliderknob.png" value="0" min="-12" max="12" step="1" basewidth="24" height="128" 
            knobwidth="24" knobheight="24" ditchlength="100" tooltip="Slider1">

                <style>

                    .webaudioctrl-tooltip
                    {
                        display:inline-block;
                        position:absolute;
                        margin:0 -1000px;
                        z-index: 999;
                        background:#eee;
                        color:#000;
                        border:1px solid #666;
                        border-radius:4px;
                        padding:5px 10px;
                        text-align:center;
                        left:0; top:0;
                        font-size:11px;
                        opacity:0;
                        visibility:hidden;
                    }
                    .webaudioctrl-tooltip:before
                    {
                        content: "";
                        position: absolute;
                        top: 100%;
                        left: 50%;
                        margin-left: -8px;
                        border: 8px solid transparent;
                        border-top: 8px solid #666;
                    }
                    .webaudioctrl-tooltip:after
                    {
                        content: "";
                        position: absolute;
                        top: 100%;
                        left: 50%;
                        margin-left: -6px;
                        border: 6px solid transparent;
                        border-top: 6px solid #eee;
                    }
                    
                    webaudio-slider
                    {
                        display:inline-block;
                        position:relative;
                        margin:0;
                        padding:0;
                        font-family: sans-serif;
                        font-size: 11px;
                        cursor:pointer;
                    }
                    .webaudio-slider-body
                    {
                        display:inline-block;
                        position:relative;
                        margin:0;
                        padding:0;
                    }
                    .webaudio-slider-knob
                    {
                        display:inline-block;
                        position:absolute;
                        margin:0;
                        padding:0;
                    }
                </style>

                <div class="webaudio-slider-body" tabindex="1" touch-action="none" style="background-size: 100% 100%; width: 24px; height: 128px; 
                    background-image: url(./MixingConsole/ChannelMixer/Image/vsliderbody.png); outline: none;">
                    <div class="webaudio-slider-knob" touch-action="none" style="background-size: 100% 100%; width: 24px; height: 24px; 
                    background-image: url(./MixingConsole/ChannelMixer/Image/vsliderknob.png); left: 0px; top: 50px;">
                    </div>
                </div>
                <div class="webaudioctrl-tooltip" style="display: inline-block; width: auto; height: auto; transition: opacity 0.1s 0s, visibility 
                    0.1s 0s; opacity: 0; visibility: hidden; left: 976.234px; top: -33px;">Slider1 : 0
                </div>

            </webaudio-slider>
            
        <p>Pan <input id="pan" type="range" min="-10" max="10" value="0" step="0.01"></p> 
        <p>Enable ?<input type="checkbox" id="switch1"></p>
    </div>

</template>

<script>

    let delaytemp = document.currentScript.ownerDocument.querySelector("#wc-channelmixer");

    class ChannelMixerGUI extends HTMLElement 
    {
        constructor(plug) 
        { 
            super();
            this._plug = plug;
            console.log(delaytemp);
            this._root = this.attachShadow({ mode: 'open' });
            this._root.appendChild(delaytemp.content.cloneNode(true));
            this.isOn = false;
            this.setListener();
            this.setSwitchListener();
        }

        get properties() 
        {
            this.boundingRect = 
            {
                dataWidth: 
                {
                    type: Number,
                    value: 120
                },
                dataHeight: 
                {
                    type: Number,
                    value: 180
                }
            };

            return this.boundingRect;
        }

        setListener() 
        {
            this._root.querySelector("#gain").addEventListener('input', (e) => this._plug.setGain(e.target.value));

            this._root.querySelector("#pan").addEventListener('input', (e) => this._plug.setPan(e.target.value));
            this._root.querySelector("#pan").addEventListener('contextmenu', (e) => 
            {
                this._plug.setPan(0);
                this._root.querySelector("#pan").value = 0;
                e.preventDefault();
            });
        }

        setSwitchListener() 
        {
            this._root.querySelector("#switch1").addEventListener('change', (e) => 
            {
                if (this.isOn) 
                    this.bypass()
                else 
                    this.reactivate();

                this.isOn = !this.isOn;
            });
        }

        bypass() 
        { this._plug.setState("disable"); }

        reactivate() 
        { this._plug.setState("enable"); }
    }

    try 
    {
        customElements.define('wasabi-channelmixer', ChannelMixerGUI);
        console.log("Element defined");

    } 
    catch(error)
    {
        console.log(error);
        console.log("Element already defined");      
    }


    createWAP = (plug) => 
    {
        let elem = new ChannelMixerGUI(plug);
        return elem; 
    }
    
</script>