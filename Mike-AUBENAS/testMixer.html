<!DOCTYPE html>
<html>

<head>
	<title>Test mixer</title>
    <meta http-equiv="origin-trial" data-feature="AudioWorklet" data-expires="2018-03-06" content="AuqouVYOpuBqGUbQMwRTvnR9R5K1T0u5vw5KUqvZQSNox/gKa/dGig1VWcPYXUzuHN1OtTijH+lhVjg8has9RggAAABseyJvcmlnaW4iOiJodHRwczovL3dhc2FiaS5pM3MudW5pY2UuZnI6NDQzIiwiZmVhdHVyZSI6IkF1ZGlvV29ya2xldCIsImV4cGlyeSI6MTUyMDI5NDQwMCwiaXNTdWJkb21haW4iOnRydWV9">
</head>

<script src="./../sdk/WebAudioSDK.js"></script>
<script src="./MixingConsole/Mixer/main.js"></script>

<body>

	<audio src="./Samples/0004-Record-Maschine.mp3" id="soundSample0" controls loop></audio>
	<audio src="./Samples/0005-Record-Maschine.mp3" id="soundSample1" controls loop></audio>
	<audio src="./Samples/0006-Record-Maschine.mp3" id="soundSample2" controls loop></audio>
	<audio src="./Samples/0007-Record-Maschine.mp3" id="soundSample3" controls loop></audio>

</body>

<script>

	var ctx = new AudioContext();
	let arrayMediaSources = new Array();
	let arrayPlayers = new Array();
	let regarde = document.querySelectorAll("audio").length;

	for(let i = 0; i < regarde; i++)
	{
		var player = document.getElementById("soundSample" + i);
		arrayPlayers.push(player);

		player.onplay = () => 
		{
			ctx.resume().then(() => 
			{
				console.log('Playback resumed successfully');
			});
		}

		let mediaSource = ctx.createMediaElementSource(player);
		arrayMediaSources.push(mediaSource);
	}

	var pluginURL = "./MixingConsole/Mixer";
	let options = {"arrayNodeToConnect" : arrayMediaSources};
	var plugin = new window.WasabiMixer(ctx, pluginURL, options);

    plugin.load().then((node) => 
    {
		console.log("node", node);
        plugin.loadGui().then((elem) => 
        {
			console.log("elem", elem);
			document.body.appendChild(elem);
		});
	});

	window.addEventListener("keydown", (event) =>
	{
		let asciiSpaceBar = 32;

		if(event.keyCode == asciiSpaceBar)
		{
			if(arrayPlayers[0].paused)
				arrayPlayers.forEach(element => { element.play(); });
			else
				arrayPlayers.forEach(element => { element.pause(); });
		}
	}, false);

</script>

</html>