<script src="https://wasabi.i3s.unice.fr/WebAudioPluginBank/bower_components/webaudio-controls2/webcomponents-lite.js"></script>
<script>
  WebAudioControlsOptions = {
    useMidi: 1,
  };
</script>
<script src="https://wasabi.i3s.unice.fr/WebAudioPluginBank/bower_components/webaudio-controls2/webaudio-controls.js"></script>
<template id="wc-plugin">
  <style>
  </style>
  <!-- Your html code here -->
</template>
<script>
  let mywctemp = document.currentScript.ownerDocument.querySelector("#wc-plugin");

    const createThruZeroFlangerGui = (p) => {
  class ThruZeroFlangerGui extends HTMLElement {
    static get is() { return 'wasabi-thruzero'; }

    constructor(plug = p) {
        super();
        this._plug = plug; // store for later use

        this._root = this.attachShadow({ mode: 'open' });
        this._root.appendChild(thruZeroTemp.content.cloneNode(true));
        this.isOn;
        this.setKnobs();
        this.setActive(false);
        this.setSwitchListener();
      }

    static get properties() {
      this.boundingRect = {
        dataWidth: {
          type: Number,
          value: 150
        },
        dataHeight: {
          type: Number,
          value: 180
        }
      };
      return this.boundingRect;
    }
    set plug(p) {
      console.log(this);
      this._plug = p;
      this.setKnobs();
      this.setActive(false);
      this.setSwitchListener();

    }

    setKnobs() {
      this._root.querySelector("#knob1").addEventListener('input', (e) => this._plug.setParam("/Thru_Zero_Flanger/Delay", e.target.value));
      this._root.querySelector("#knob2").addEventListener('input', (e) => this._plug.setParam("/Thru_Zero_Flanger/Depth", e.target.value));
      this._root.querySelector("#knob3").addEventListener('input', (e) => this._plug.setParam("/Thru_Zero_Flanger/L-R_Offset", e.target.value));
      this._root.querySelector("#knob4").addEventListener('input', (e) => this._plug.setParam("/Thru_Zero_Flanger/Rate", e.target.value));
    
    }

   setActive(active) {
        if (active == undefined || active == false) {
          this.isOn = false;
          this.bypass();
          this._root.querySelector("#switch1").value = 0;
        } else if (active) {
          this.isOn = true;
          this.reactivate();
          this._root.querySelector("#switch1").value = 1;
        }
      }

    setSwitchListener() {
      console.log("setswitch");
      this._root.querySelector("#switch1").addEventListener('change', (e) => {
        if (this.isOn) this.bypass()
        else this.reactivate();
        this.isOn = !this.isOn;
      });
    }

    bypass() {
      this._plug.setParam("/Thru_Zero_Flanger/bypass",1);
      console.log("disabled");
    }

    reactivate() {
      this._plug.setParam("/Thru_Zero_Flanger/bypass",0);

    }


  }
  // Register the x-custom element with the browser
  try {
    customElements.define('wasabi-thruzero', ThruZeroFlangerGui);
    
  } catch (error) {
    console.log("Element already defined");
  }
  return document.createElement("wasabi-thruzero");

    }
</script>