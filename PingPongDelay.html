<script src="./PingPongDelay.js"></script>
<script>UseWebAudioControlsMidi = 1</script>
  <template id="wc-pingpongdelay">
    <style>
      :host {
        box-shadow: inset -3px -3px 3px 5px rgba(0, 0, 0, 0.6), inset 3px 3px 3px 5px rgba(255, 255, 255, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.9), 0 4px 5px 0 rgba(0, 0, 0, 0.9), 0 1px 10px 0 rgba(0, 0, 0, 0.9);

        width: [[dataWidth]]px;
        height: [[dataHeight]]px;
        border-radius: 10px;

        position: absolute;
        top: 0px;
        left: 0px;
        display: block;
        user-select: none;
        cursor: move;
      }

      webaudio-switch {
        left: -6px;
      }

      .pedalLabel {
        font-size: 20px;
        text-align: center;
        user-select: none;
        font-family: Lemon\/Milk;
      }

      .knob-label {
        font-size: 10px;

        text-align: center;
        overflow: hidden;
        user-select: none;
      }

      .elements {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        padding: 10px;
      }

      .column {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;

        flex: 1;
        margin: 1px;
      }

      .row {
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
        align-items: stretch;
      }
    </style>
    <div class="row">
      <div class="column">
        <webaudio-knob id="knob1" class="knob" sprites="99" value="0" step="1" midilearn="true" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_yellow_not_stripped.png"
          width="40" height="40" data-role="feedback"></webaudio-knob>
        <span class="knob-label" id="knob1-label">FEEDBACK</span>
      </div>
      <div class="column">
        <webaudio-knob id="knob2" class="knob" sprites="99" value="0" step="1" midilearn="true" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_yellow_not_stripped.png"
          width="40" height="40" data-role="time"></webaudio-knob>
        <span class="knob-label" id="knob2-label">TIME</span>
      </div>
    </div>
    <div class="row">
      <div class="column">
        <webaudio-knob id="knob3" class="knob" sprites="99" value="0" step="1" midilearn="true" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/nux_yellow_not_stripped.png"
          width="40" height="40" data-role="mix"></webaudio-knob>
        <span class="knob-label" id="knob3-label">MIX</span>
      </div>
    </div>

    <div class="row">
      <div class="column">
        <webaudio-switch id="switch1" class="switch" midilearn="true" src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/img/switch_1.png" width="40" height="25"></webaudio-switch>
      </div>
    </div>
    <div class="row">
      <div class="column">
        <span class="pedalLabel">DELAY</span>
      </div>
    </div>
  </template>
  <script>
    let wctemp = document.currentScript.ownerDocument.querySelector("#wc-pingpongdelay");  
    class PingPongDelayGui extends HTMLElement {

      constructor(){
        super();
        this._root = this.attachShadow({ mode: 'open' });
        this._root.appendChild(wctemp.content.cloneNode(true));
      }

      static get properties() {
        this.boundingRect = {
          dataWidth: {
            type: Number,
            value: 120
          },
          dataHeight: {
            type: Number,
            value: 180
          }
        };
        return this.boundingRect;
      }
      set plug (p)  { this._plug = p; }

     setKnobs(){
        this.$.knob1.addEventListener('change', (e) => this._plug.setParam("feedback",e.target.value / 100));
        this.$.knob2.addEventListener('change', (e) => this._plug.setParam("time",e.target.value / 100));
        this.$.knob3.addEventListener('change', (e) => this._plug.setParam("mix",e.target.value / 100));
     }

      setSwitchListener() {
        this.$.switch1.addEventListener('change',(e)=>{
          if (this.isOn) this.bypass();
          else this.reactivate();

          this.isOn = !this.isOn;
        });
      }
      setPedalActive(active) {
        if (active == undefined || active == false) {
          this.isOn = false;
          this.bypass();
          this.$.switch1.value = 0;
        } else if (active) {
          this.isOn = true;
          this.reactivate();
          this.$.switch1.value = 1;
        }
      }
      bypass() {
        this._plug.setState("disable");
      }
      reactivate() {
        this._plug.setState("enable");
      }

    }
    // Register the x-custom element with the browser
    window.customElements.define('wc-pingpongdelay', PingPongDelayGui);
  </script>
