<!-- Plugin dependencies 
     The Delay depends on Polymer 2 because it uses the webaudiocontrols knobs, etc
     that also depend on Polymer. If we remove this dependency, then the delay
     would have zero dependencies on its own.

     These should be located on a "shared" repo, or on CDNs
-->
<script src="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/bower_components/polymer/polymer.html">
<link rel="import" href="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/bower_components/webaudio-controls/webaudio-controls.html">
<!-- Plugin in its redistribuable form, note that we use here an 
     absolute URL, that means that YOU can use it too in YOUR html page/host -->
<link rel="import" href="https://wasabi.i3s.unice.fr/plugins/delay-plugin/WebAudioPluginBank/wc-delay.html">

<!-- Here we have a VERY preliminary code that unit tests the API,
     with hard coded names etc. -->
<script src="./testAPI.js"></script>

<!-- What follows is an example of html/js code that instanciates it :
The wc-pingpongdelay html tag is the custom element defined in the 
imported html file of the redistribuable plugin
The instruction:
let wcdelay = document.getElementById("WCdelay");

here wcdelay is the plugin object that implements the plugin API
-->
<!doctype html>
<html>
<style include="shared-styles">
  #WCdelay {
    top: 30%;
    left: 10%;
  }

  #APITest {
    position: relative;
    top: 40%;
    
  }
</style>

<title>Plugin tester</title>
</head>

<body>
  <div class="title">
    <h1>Plugin Tester</h1>
  </div>
  <div class="content">
    <wc-pingpongdelay id="WCdelay"></wc-pingpongdelay>
    <audio src="./BasketCaseGreendayriffDI.mp3" id="soundSample" controls loop></audio>
    <h3>Soon you'll be able to test here if your Web audio plugin is compliant to the API</h3>
  </div>
  <div id="APITest">
  </div>

</body>
<script>
  var AudioContext = window.AudioContext || window.webkitAudioContext;
  var contexteAudio = new AudioContext();
  let player = document.getElementById("soundSample");
  let mediaSource = contexteAudio.createMediaElementSource(player);
  let wcdelay = document.getElementById("WCdelay");

  console.log(wcdelay);
  wcdelay.buildGraph(contexteAudio);
  mediaSource.connect(wcdelay.getEffect().getInputNode());
  console.log(contexteAudio.destination);

  // the wcdelay plugin does is not yet compliant with the API from the paper
  // it acts like the "host" of the plugin in the wam/fasut sense
  // we could have wcdelay.node or wcdelay.getRootNode() ... ?
  wcdelay.getEffect().getOutputNode().connect(contexteAudio.destination);
</script>

</html>