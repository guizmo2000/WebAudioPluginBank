<script src="https://wasabi.i3s.unice.fr/WebAudioPluginBank/bower_components/webaudio-controls2/webcomponents-lite.js"></script>
<script>
  WebAudioControlsOptions = {
    useMidi: 1,
  };
</script>
<script src="https://wasabi.i3s.unice.fr/WebAudioPluginBank/bower_components/webaudio-controls2/webaudio-controls.js"></script>
<template id="wc-amp">
  <style>
  </style>
  <div class="ampGUI" style="position:relative;background-image: url('img/imageprincipalefinienew.png');width:1127px;height:545px;padding:0px;">
    <div>
      <webaudio-knob id="Knob1" midilearn="true" step="0.1" style="position:absolute;left:66px;top:90px" src="img/Prophet.png"
        value="7" min="0" max="10" diameter="69" sprites="99" tooltip="Volume"></webaudio-knob>
      <webaudio-knob id="Knob2" midilearn="true" step="0.1" style="position:absolute;left:136px;top:90px" src="img/Prophet.png"
        value="2" min="0" max="10" diameter="69" sprites="99" tooltip="Master"></webaudio-knob>
      <!-- boost button -->
      <label style="color:white;position:absolute;left:70px;top:64px">Clean / Disto : </label>
      <!--
        <webaudio-switch style="color:white; position:absolute;left:225px;top:58px" id="toggleBoost" value="0" src="img/led.png" tooltip="Toggle clean/disto channel"></webaudio-switch>
        -->
      <webaudio-switch midilearn="true" style="color:white; position:absolute;left:170px;top:58px" id="toggleBoost" value="0" src="img/boostSwitch.png"
        tooltip="Toggle clean/disto channel"></webaudio-switch>
      <!-- drive knob -->
      <webaudio-knob id="Knob3" midilearn="true" style="position:absolute;left:207px;top:90px" src="img/Prophet.png" value="0"
        step="0.1" min="0" max="10" diameter="69" sprites="99" tooltip="Drive"></webaudio-knob>
      <webaudio-knob id="Knob4" midilearn="true" style="position:absolute;left:275px;top:90px" src="img/Prophet.png" value="5"
        min="0" max="10" step="0.1" diameter="69" sprites="99" tooltip="Bass"></webaudio-knob>
      <webaudio-knob id="Knob5" midilearn="true" style="position:absolute;left:345px;top:90px" src="img/Prophet.png" value="5"
        min="0" max="10" step="0.1" diameter="69" sprites="99" tooltip="Middle"></webaudio-knob>
      <webaudio-knob id="Knob6" midilearn="true" style="position:absolute;left:415px;top:90px" src="img/Prophet.png" value="5"
        min="0" max="10" step="0.1" diameter="69" sprites="99" tooltip="Treble"></webaudio-knob>
      <webaudio-knob id="Knob7" midilearn="true" style="position:absolute;left:486px;top:90px" src="img/Prophet.png" value="2"
        min="0" max="10" step="0.1" diameter="69" sprites="99" tooltip="Reverb"></webaudio-knob>
      <select style="position:absolute;left:455px;top:190px" id="reverbImpulses" oninput="this.ampCtrl.changeReverbImpulse(this.value);">
      </select>
      <webaudio-knob id="Knob8" midilearn="true" style="position:absolute;left:557px;top:90px" src="img/Prophet.png" value="5"
        min="0" max="10" step="0.1" diameter="69" sprites="99" tooltip="Presence"></webaudio-knob>
    </div>
    <webaudio-slider id="slider1" midilearn="true" Units="Db" style="position:absolute;left:731px;top:64px" src="img/vsliderbody.png"
      knobsrc="img/vsliderknob.png" value="0" min="-12" max="12" step="1" basewidth="24" height="128" knobwidth="24" knobheight="24"
      ditchLength="100" tooltip="Slider1"></webaudio-slider>
    <webaudio-slider id="slider2" midilearn="true" Units="Db" style="position:absolute;left:774px;top:64px" src="img/vsliderbody.png"
      knobsrc="img/vsliderknob.png" value="0" min="-12" max="12" step="1" width="24" height="128" knobwidth="24" knobheight="24"
      ditchLength="100" tooltip="Slider2"></webaudio-slider>
    <webaudio-slider id="slider3" midilearn="true" Units="Db" style="position:absolute;left:819px;top:64px" src="img/vsliderbody.png"
      knobsrc="img/vsliderknob.png" value="0" min="-12" max="12" step="1" width="24" height="128" knobwidth="24" knobheight="24"
      ditchLength="100" tooltip="Slider3"></webaudio-slider>
    <webaudio-slider id="slider4" midilearn="true" Units="Db" style="position:absolute;left:865px;top:64px" src="img/vsliderbody.png"
      knobsrc="img/vsliderknob.png" value="0" min="-12" max="12" step="1" width="24" height="128" knobwidth="24" knobheight="24"
      ditchLength="100" units="%" tooltip="Slider4"></webaudio-slider>
    <webaudio-slider id="slider5" midilearn="true" Units="Db" style="position:absolute;left:908px;top:64px" src="img/vsliderbody.png"
      knobsrc="img/vsliderknob.png" value="0" min="-12" max="12" step="1" width="24" height="128" knobwidth="24" knobheight="24"
      ditchLength="100" tooltip="Slider5"></webaudio-slider>
    <webaudio-slider id="slider6" midilearn="true" Units="Db" style="position:absolute;left:951px;top:64px" src="img/vsliderbody.png"
      knobsrc="img/vsliderknob.png" value="0" min="-12" max="12" step="1" width="24" height="128" knobwidth="24" knobheight="24"
      ditchLength="100" units="%" tooltip="Slider6"></webaudio-slider>
    <webaudio-switch id="switch1" midilearn="true" style="position:absolute;left:1033px;top:72px" src="img/switch_toggle.png"
      value="0" height="45" width="45" tooltip="Switch-A Tooltip text test"></webaudio-switch>
    <webaudio-switch id="led" style="position:absolute;left:1043px;top:125px" src="img/led_23_red.png" value="1" height="23"
      width="23" tooltip="Switch-B"></webaudio-switch>
    <webaudio-switch id="switch2" midilearn="true" style="position:absolute;left:1033px;top:140px" src="img/switch_toggle.png"
      value="0" height="45" width="45" tooltip="Switch-B"></webaudio-switch>
      <span style='color:red;'>NOT ACTIVATED</span>, click to toggle on/off!</button>
    <label for="QFPresetMenu2" style="color:white; position:absolute;left:790px;top:270px">Presets :</label>
    <select id="QFPresetMenu2" style="position:absolute;left:850px;top:270px" onchange="this.ampCtrl.setPreset()"></select>
</template>
<script>
  let amptemp = document.currentScript.ownerDocument.querySelector("#wc-amp");
  // Ecapsulate the WebComponent class into a function, like this we can pass
  // a parameter to its constructor (the audio node/audio processor)
  class AmpSimGui extends HTMLElement {

    constructor(plug,controller,viewer) {
      super();
      console.log(plug);
      this._plug = plug;
      this.ampCtrl = controller;
      console.log(this._plug);
      this._root = this.attachShadow({ mode: 'open' });
      this._root.appendChild(amptemp.content.cloneNode(true));
      // this.isOn = false;
      // this.setKnobs();
      // this.setSwitchListener();
    }

    get properties() {
      this.boundingRect = {
        dataWidth: {
          type: Number,
          value: 500
        },
        dataHeight: {
          type: Number,
          value: 150
        }
      };
      return this.boundingRect;
    }


    setKnobs() {
      console.log('setknobs');
      var volumeOutputPreAmp = this._root.querySelector("#Knob1");
            volumeOutputPreAmp.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeOutputGain(evt.target.value);
            });

            // Master Volume
            var masterVolume = this._root.querySelector("#Knob2");
            masterVolume.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeMasterVolume(evt.target.value);
            });

            // Drive
            var drive = this._root.querySelector("#Knob3");
            drive.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeDrive(evt.target.value);
            });

            // Bass
            var bass = this._root.querySelector("#Knob4");
            bass.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeBassFilterValue(evt.target.value);
            });

            // Middle
            var mid = this._root.querySelector("#Knob5");
            mid.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeMidFilterValue(evt.target.value);
            });

            // Treble
            var treble = this._root.querySelector("#Knob6");
            treble.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeTrebleFilterValue(evt.target.value);
            });

            // Reverb
            var reverb = this._root.querySelector("#Knob7");
            reverb.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeReverbGain(evt.target.value);
            });

            // Presence 
            var presence = this._root.querySelector("#Knob8");
            presence.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changePresenceFilterValue(evt.target.value);
            });

            // input gain
            var inputGain = this._root.querySelector("#Knob9");
            inputGain.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeInputGainValue(evt.target.value);
            });

            // output gain
            var outputGain = this._root.querySelector("#Knob10");
            outputGain.addEventListener("change", function (evt) {
                if(this.ampCtrl !== undefined)
                    this.ampCtrl.changeOutputGainValue(evt.target.value);
            });

            // Equalizer
            for (var i = 1; i < 7; i++) {
                createListenerForEQ(i);
            }

            function createListenerForEQ(i) {
                var eq = this._root.querySelector("#slider" + i);
                eq.addEventListener("change", function (evt) {
                    if(this.ampCtrl !== undefined)
                        this.ampCtrl.changeGain(evt.target.value, i - 1);
                });
            }

            // On / Off switch
            var onOff = this._root.querySelector("#switch1");
            onOff.addEventListener("change", function (evt) {
                if(this.ampCtrl === undefined) return;
                
                var state = {};
                if (evt.target.value == 1) {
                    state.checked = false;
                } else {
                    state.checked = true;
                }
                this.ampCtrl.bypass(state);
            });

            // EQ on/off switch
            var eqOnOff = this._root.querySelector("#switch2");
            eqOnOff.addEventListener("change", function (evt) {
                var state = {};
                if (evt.target.value == 1) {
                    state.checked = false;
                } else {
                    state.checked = true;
                }
                this.ampCtrl.bypassEQ(state);
            });

            var boostOnOff = this._root.querySelector("#toggleBoost");
            boostOnOff.addEventListener("change", function (evt) {
                var state = {};
                if (evt.target.value == 1) {
                    state.checked = false;
                } else {
                    state.checked = true;
                }
                this.ampCtrl.boostOnOff(state);
            });


    }



  //   setSwitchListener() {
  //     console.log("setswitch");
  //     this._root.querySelector("#switch1").addEventListener('change', (e) => {
  //       if (this.isOn) this.bypass()
  //       else this.reactivate();
  //       this.isOn = !this.isOn;
  //     });
  //   }

  //   bypass() {
  //     this._plug.setState("disable");
  //   }
  //   reactivate() {
  //     this._plug.setState("enable");
  //   }

  }

  

  try {
    customElements.define('buffa-ampsim', AmpSimGui);
    console.log("Element defined");
  } catch {
    console.log("Element already defined");
  }


  createAmpGui = (plug,controller, viewer) => {
    let elem = new AmpSimGui(plug,controller, viewer);
    return elem;
  }
</script>